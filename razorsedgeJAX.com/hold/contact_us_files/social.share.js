define(["modules/util/util.instances","modules/util/util.model","jq!starfield/jquery.mod","js!//s7.addthis.com/js/300/addthis_widget.js#async=1"],function(e,t,n){function i(e,n){this.$element=e,this.model=new t(n),this.mode=this.model.get("mode"),this.subscriptions=[],this.init()}var r="wsb-social-share";i.prototype={init:function(){var e=this;if(this.mode=="designer"&&this.model.isKO){var t=this.model.get();if(t.mutatorViewModel){var n=function(){e.refresh()};for(var r in t.mutatorViewModel)t.ko.isObservable(t.mutatorViewModel[r])&&this.subscriptions.push(t.mutatorViewModel[r].subscribe(n))}}this.refresh(!0)},ready:function(e){addthis.init(),addthis.toolbox(this.$element[0]),this.mode=="designer"&&this.updateOverlay(e)},refresh:function(e){var t=this;this.$element.attr("class",r).children().remove();var i="",s=r+"-button",o=this.model.get("ShareTheme");if(this.mode=="mobile")switch(o){case"Small Buttons":case"Small Buttons - Vertical":case"Buttons - Vertical":o="Buttons";break;case"Counter":case"Counter - Vertical":case"Horizontal Counter":case"Bubble Counter - Vertical":case"Vertical Counter":o="Bubble Counter"}Boolean(o.match(/- Vertical$/i))&&(s+="-vert");switch(o){case"Buttons":case"Buttons - Vertical":this.$element.addClass("addthis_toolbox addthis_default_style addthis_32x32_style"),this.model.get("ShareFacebook")&&(i+='<a class="addthis_button_facebook '+s+'"></a>'),this.model.get("ShareTwitter")&&(i+='<a class="addthis_button_twitter '+s+'"></a>'),this.model.get("ShareGoogle")&&(i+='<a class="addthis_button_google_plusone_share '+s+'"></a>'),this.model.get("SharePinterest")&&(i+='<a class="addthis_button_pinterest_share '+s+'"></a>'),this.model.get("ShareEmail")&&(i+='<a class="addthis_button_email '+s+'"></a>'),this.model.get("ShareMore")&&(i+='<a class="addthis_button_expanded '+s+'"></a>');break;case"Small Buttons":case"Small Buttons - Vertical":this.$element.addClass("addthis_toolbox addthis_default_style"),this.model.get("ShareFacebook")&&(i+='<a class="addthis_button_facebook '+s+'"></a>'),this.model.get("ShareTwitter")&&(i+='<a class="addthis_button_twitter '+s+'"></a>'),this.model.get("ShareGoogle")&&(i+='<a class="addthis_button_google_plusone_share '+s+'"></a>'),this.model.get("SharePinterest")&&(i+='<a class="addthis_button_pinterest_share '+s+'"></a>'),this.model.get("ShareEmail")&&(i+='<a class="addthis_button_email '+s+'"></a>'),this.model.get("ShareMore")&&(i+='<a class="addthis_button_expanded '+s+'"></a>');break;case"Toolbar":i+='<a class="addthis_button" href="//www.addthis.com/bookmark.php?v=300&amp;pubid=xa-5107daf277cd4d0c"><img src="//s7.addthis.com/static/btn/v2/lg-share-en.gif" width="125" height="16" alt="Bookmark and Share" style="border:0"/></a>';break;default:case"Counter":case"Counter - Vertical":case"Horizontal Counter":this.$element.addClass("addthis_toolbox addthis_default_style"),this.model.get("ShareFacebook")&&(i+='<a class="addthis_button_facebook_like '+s+'" fb:like:layout="button_count"></a>'),this.model.get("ShareTwitter")&&(i+='<a class="addthis_button_tweet '+s+'"></a>'),this.model.get("ShareGoogle")&&(i+='<a class="addthis_button_google_plusone '+s+'" g:plusone:size="medium"></a>');break;case"Bubble Counter":case"Bubble Counter - Vertical":case"Vertical Counter":this.$element.addClass("addthis_toolbox addthis_default_style addthis_counter_style"),this.model.get("ShareFacebook")&&(i+='<a class="addthis_button_facebook_like '+s+'" fb:like:layout="box_count"></a>'),this.model.get("ShareTwitter")&&(i+='<a class="addthis_button_tweet '+s+'" tw:count="vertical"></a>'),this.model.get("ShareGoogle")&&(i+='<a class="addthis_button_google_plusone '+s+'" g:plusone:size="tall"></a>')}this.$element.html(i),typeof addthis!="object"?n(document).ready(function(){t.ready(e)}):t.ready(e)},updateOverlay:function(e){var t=n("."+r+"-overlay",this.$element);t.length||(t=n("<div/>").addClass(r+"-overlay").css({filter:"alpha(opacity = 0)","background-color":"transparent"}).appendTo(this.$element));if(!e&&this.model.isKO){var i=this;clearInterval(this.overlayTimer),this.overlayTimerCount=0;var s=i.model.get("wsb",!0).actionbar.undoer;this.overlayTimer=setInterval(function(){if(i.overlayTimerCount>=20)clearInterval(i.overlayTimer),i.overlayTimerCount=0;else{var e=s.getCurrentState()!="collect";i.overlayTimerCount++,i.$element.removeClass("resized");if(e){var t=i.model.get("getLast",!0)("Width"),n=i.model.get("getLast",!0)("Height");if(parseFloat((t&&t.NewValue||i.model.get("Width")).replace("px",""))<i.$element.outerWidth(!0)){s.disable();var r=i.$element.outerWidth(!0)+"px";t&&(t.NewValue=r),i.model.set("Width",r),s.enable()}if(parseFloat((n&&n.NewValue||i.model.get("Height")).replace("px",""))<i.$element.outerHeight(!0)){s.disable();var o=i.$element.outerHeight(!0)+"px";n&&(n.NewValue=o),i.model.set("Height",o),s.enable()}}else parseFloat(i.model.get("Width").replace("px",""))<i.$element.outerWidth(!0)&&i.model.set("Width",i.$element.outerWidth(!0)+"px"),parseFloat(i.model.get("Height").replace("px",""))<i.$element.outerHeight(!0)&&i.model.set("Height",i.$element.outerHeight(!0)+"px");i.$element.addClass("resized")}},100)}},destroy:function(){for(var e in this.subscriptions)this.subscriptions[e].dispose();s.destroy(this.$element),this.$element.remove()}};var s=new e(r,i);return{render:function(e,t){var n=s.get(e);return n?n.refresh():n=s.create(e,t),n},destroy:function(e){var t=s.get(e);return t?(s.destroy(e),!0):!1}}});