define(["jq!starfield/jquery.mod","modules/regexhelper/regexhelper","libs/jquery/plugins/jquery.xDomainRequest"],function(e,t){function n(n,r,i,s,o){var u=this,a,f,l,c,h,p,d,v="form-button-disabled",m="form-value-invalid";this.cacheSelectors=function(){f=e("div#"+r),a=e("div#"+n),l=a.find('input[type="submit"]'),c=a.find('input[name="name"]'),h=a.find('input[name="email"]'),p=a.find('input[name="subject"]'),d=a.find('textarea[name="message"]')},this.hideSuccessMessage=function(){f.hide()},this.showSuccessMessage=function(){f.show(),f.parent().css("overflow","auto")},this.hideForm=function(){a.children(".form-body").hide()},this.showForm=function(){a.show()},this.setInitialParams=function(){a.find('input[name="param1"]').val(window.location.host),a.find('input[name="param2"]').val(window.location.href)},this.wireUpClickEvent=function(){l.click(u.onSubmitClick)},this.removeInvalidCssFromInputs=function(){c.removeClass(m),h.removeClass(m),p.removeClass(m),d.removeClass(m)},this.addInvalidCssToInput=function(e){var t;switch(e){case"message":t=d;break;case"name":t=c;break;case"email":t=h;break;case"subject":t=p}t&&t.addClass(m)},this.getCurrentFormValues=function(){return{name:e.trim(c.val()),email:e.trim(h.val()),subject:e.trim(p.val()),message:e.trim(d.val()),param1:a.find('input[name="param1"]').val(),param2:a.find('input[name="param2"]').val(),param3:a.find('input[name="param3"]').val(),param4:a.find('input[name="param4"]').val(),param5:a.find('input[name="param5"]').val(),param6:a.find('input[name="param6"]').val()}},this.validateFormValues=function(e){var n=!0;return e.name.length===0&&(n=!1,u.addInvalidCssToInput("name")),e.email.length===0?(n=!1,u.addInvalidCssToInput("email")):t.validateEmailAddress(e.email)||(n=!1,u.addInvalidCssToInput("email")),e.subject.length===0&&(n=!1,u.addInvalidCssToInput("subject")),e.message.length===0&&(n=!1,u.addInvalidCssToInput("message")),n},this.isButtonDisabled=function(){return l.hasClass(v)},this.sendFormPost=function(t){e.ajax({url:i,contentType:"application/x-www-form-urlencoded",data:{0:t},type:"POST",crossDomain:!0,dataType:"text",success:u.onSubmitSuccess,error:u.onSubmitSuccess})},this.setWindowLocation=function(e){window.location=e},this.onLoad=function(){u.cacheSelectors(),u.hideSuccessMessage(),u.showForm(),u.setInitialParams(),u.wireUpClickEvent()},this.onSubmitClick=function(){u.removeInvalidCssFromInputs();var t=u.getCurrentFormValues();if(!u.validateFormValues(t))return;if(u.isButtonDisabled())return;l.addClass(v);var n=e.param(t);u.sendFormPost(n)},this.onSubmitSuccess=function(){s===0?(u.hideForm(),u.showSuccessMessage()):u.setWindowLocation(o)},this.init=function(){e(document).ready(u.onLoad)}}return n});